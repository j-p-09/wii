<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMAČE OLIMPIJSKE IGRE 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.08);
            --glass-heavy: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.18);
            --accent: #00d2ff;
            --gold: #FFD700;
            --silver: #E3E3E3;
            --bronze: #CD7F32;
            --danger: #ff4757;
            --success: #2ed573;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background: radial-gradient(circle at top right, #1e3c72, #2a5298, #000);
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .animate { animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        .nav-wrapper {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: fit-content;
        }

        nav#main-nav {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            padding: 8px 15px;
            display: flex;
            gap: 5px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        nav#main-nav button {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            border-radius: 100px;
            transition: all 0.4s ease;
        }

        nav#main-nav button.active, nav#main-nav button:hover {
            background: var(--glass-heavy);
            color: #fff;
            text-shadow: 0 0 10px var(--accent);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 140px 20px 60px;
        }

        section { display: none; }
        section.active { display: block; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        h1 { font-weight: 800; font-size: 2.5rem; text-align: center; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 5px; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { padding: 15px; text-align: left; color: rgba(255,255,255,0.5); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; }
        td { padding: 15px; background: rgba(255,255,255,0.03); vertical-align: middle; }
        tr td:first-child { border-radius: 15px 0 0 15px; }
        tr td:last-child { border-radius: 0 15px 15px 0; }

        .flag-box { width: 45px; height: 30px; border-radius: 6px; object-fit: cover; box-shadow: 0 5px 15px rgba(0,0,0,0.3); margin-right: 15px; border: 1px solid rgba(255,255,255,0.1); }

        .medal-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }

        .view-tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab-btn.active { background: var(--accent); border-color: var(--accent); font-weight: bold; color: #000; }

        .admin-layout { display: grid; grid-template-columns: 240px 1fr; gap: 30px; }
        @media (max-width: 768px) { .admin-layout { grid-template-columns: 1fr; } }

        .admin-sidebar { display: flex; flex-direction: column; gap: 10px; }
        .admin-sidebar button {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 15px;
            text-align: left;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        .admin-sidebar button:hover, .admin-sidebar button.active { background: rgba(255,255,255,0.2); transform: translateX(5px); }

        input, select, textarea {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            padding: 12px 15px;
            color: #fff;
            border-radius: 12px;
            width: 100%;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        .btn-save { background: var(--accent); color: #000; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: 800; width: 100%; transition: 0.3s; }
        .btn-save:hover { filter: brightness(1.2); }

        .country-group-header {
            background: var(--glass-heavy);
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 800;
            color: var(--accent);
            display: flex;
            align-items: center;
        }
        .no-data-msg { padding: 20px; text-align: center; opacity: 0.5; font-style: italic; }
    </style>
</head>
<body>

<div class="nav-wrapper">
    <nav id="main-nav">
        <button onclick="changeSection('medals', this)" class="active">Medalije</button>
        <button onclick="changeSection('categories', this)">Kategorije</button>
        <button onclick="changeSection('total', this)">Skupni seštevek</button>
        <button onclick="changeSection('login', this)">Prijava</button>
    </nav>
</div>

<div class="container">
    
    <section id="medals" class="active animate">
        <h1>Olimpijske Medalje</h1>
        <div class="glass-card">
            <table>
                <thead>
                    <tr>
                        <th>Država</th>
                        <th><i class="fas fa-medal"></i> Skupno</th>
                        <th><i class="fas fa-circle" style="color:var(--gold)"></i> Zlato</th>
                        <th><i class="fas fa-circle" style="color:var(--silver)"></i> Srebro</th>
                        <th><i class="fas fa-circle" style="color:var(--bronze)"></i> Bron</th>
                    </tr>
                </thead>
                <tbody id="medal-table-body"></tbody>
            </table>
        </div>
    </section>

    <section id="categories" class="animate">
        <h1>Rezultati po Kategorijah</h1>
        <div class="view-tabs" id="public-cat-tabs"></div>
        <div class="glass-card">
            <table>
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Tekmovalec</th>
                        <th>Država</th>
                        <th>Skupni Rezultat</th>
                    </tr>
                </thead>
                <tbody id="cat-results-body"></tbody>
            </table>
        </div>
    </section>

    <section id="total" class="animate">
        <h1>Skupna Razvrstitev</h1>
        <div class="glass-card">
            <table>
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Država</th>
                        <th>Zastava</th>
                        <th>Točke</th>
                    </tr>
                </thead>
                <tbody id="total-points-body"></tbody>
            </table>
        </div>
    </section>

    <section id="login" class="animate">
        <div class="glass-card" style="max-width: 450px; margin: 0 auto;">
            <h2 style="text-align: center; margin-bottom: 30px;">Admin Prijava</h2>
            <input type="text" id="user" placeholder="ADMIN">
            <input type="password" id="pass" placeholder="••••••••">
            <button class="btn-save" onclick="handleLogin()">VSTOPI</button>
        </div>
    </section>

    <section id="admin-panel" class="animate">
        <h1>Nadzorna Plošča (ADMIN)</h1>
        <div class="admin-layout">
            <div class="admin-sidebar">
                <button onclick="showAdminSub('a-cats', this)" class="active">Kategorije</button>
                <button onclick="showAdminSub('a-res', this)">Vpis Rezultatov</button>
                <button onclick="showAdminSub('a-athletes', this)">Države & Tekmovalci</button>
                <button onclick="logout()" style="color:var(--danger)">Odjava</button>
            </div>
            
            <div class="admin-main">
                <div id="a-cats" class="admin-sub animate">
                    <div class="glass-card">
                        <h3>Nova Kategorija</h3>
                        <input type="text" id="cat-name" placeholder="Ime (npr. Tek na 100m)">
                        <select id="cat-env"><option value="outdoor">Zunanje</option><option value="indoor">Notranje</option></select>
                        <input type="text" id="cat-unit" placeholder="Enota (sek, m, kg)">
                        <select id="cat-dir"><option value="asc">Manj je bolje (Čas)</option><option value="desc">Več je bolje (Daljava/Točke)</option></select>
                        <input type="number" id="cat-series" placeholder="Število serij" value="1">
                        <input type="number" id="cat-attempts" placeholder="Poskusov v seriji" value="1">
                        <button class="btn-save" onclick="db_addCategory()">Dodaj Kategorijo</button>
                    </div>
                </div>

                <div id="a-res" class="admin-sub" style="display:none;">
                    <div class="glass-card">
                        <h3>Vpis Rezultatov</h3>
                        <p style="font-size: 0.8rem; margin-bottom: 10px; opacity: 0.7;">* 3x DNF = Celoten rezultat DNF. Manj kot 3x DNF se seštejejo le številke.</p>
                        <select id="res-cat-sel" onchange="loadResultEntry()"></select>
                        <input type="date" id="res-date">
                        <div id="res-entry-area"></div>
                        <button class="btn-save" id="btn-save-res" style="display:none; margin-top:20px;" onclick="db_saveResults()">Shrani Vse Rezultate</button>
                    </div>
                </div>

                <div id="a-athletes" class="admin-sub" style="display:none;">
                    <div class="glass-card">
                        <h3>Države</h3>
                        <input type="text" id="c-name" placeholder="Ime države">
                        <input type="text" id="c-code" placeholder="Koda (npr: si, us, de)">
                        <button class="btn-save" style="background:#444; color:#fff;" onclick="db_addCountry()">Dodaj Državo</button>
                        <hr style="margin: 20px 0; opacity: 0.1;">
                        <h3>Tekmovalci</h3>
                        <input type="text" id="ath-name" placeholder="Ime in priimek">
                        <select id="ath-c-sel" multiple style="height:100px;"></select>
                        <button class="btn-save" onclick="db_addAthlete()">Dodaj Tekmovalca</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    // --- DATABASE ---
    let db = JSON.parse(localStorage.getItem('olympics_pro_db_v2')) || {
        countries: [], athletes: [], categories: [], results: []
    };

    function sync() {
        localStorage.setItem('olympics_pro_db_v2', JSON.stringify(db));
        refreshUI();
    }

    // --- NAV ---
    function changeSection(id, btn) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('#main-nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(btn) btn.classList.add('active');
        refreshUI();
    }

    function showAdminSub(id, btn) {
        document.querySelectorAll('.admin-sub').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.admin-sidebar button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).style.display = 'block';
        if(btn) btn.classList.add('active');
    }

    // --- DB ACTIONS ---
    function db_addCountry() {
        const name = document.getElementById('c-name').value;
        const code = document.getElementById('c-code').value.toLowerCase();
        if(name && code) {
            db.countries.push({ id: "C" + Date.now(), name, code });
            sync();
            document.getElementById('c-name').value = ''; document.getElementById('c-code').value = '';
        }
    }

    function db_addAthlete() {
        const name = document.getElementById('ath-name').value;
        const cIds = Array.from(document.getElementById('ath-c-sel').selectedOptions).map(o => o.value);
        if(name && cIds.length > 0) {
            db.athletes.push({ id: "A" + Date.now(), name, countries: cIds });
            sync();
            document.getElementById('ath-name').value = '';
        } else { alert("Vnesi ime in izberi vsaj eno državo!"); }
    }

    function db_addCategory() {
        const name = document.getElementById('cat-name').value;
        if(!name) return;
        db.categories.push({
            id: "CAT" + Date.now(),
            name: name,
            env: document.getElementById('cat-env').value,
            unit: document.getElementById('cat-unit').value,
            dir: document.getElementById('cat-dir').value,
            series: parseInt(document.getElementById('cat-series').value) || 1,
            attempts: parseInt(document.getElementById('cat-attempts').value) || 1
        });
        sync();
        document.getElementById('cat-name').value = '';
    }

    // --- VPIS REZULTATOV ---
    function loadResultEntry() {
        const catId = document.getElementById('res-cat-sel').value;
        const area = document.getElementById('res-entry-area');
        area.innerHTML = '';
        if(!catId) return;
        const cat = db.categories.find(c => c.id === catId);
        
        let foundAny = false;
        db.countries.forEach(country => {
            const countryAthletes = db.athletes.filter(ath => ath.countries.includes(country.id));
            if(countryAthletes.length > 0) {
                foundAny = true;
                let countryHtml = `<div class="country-group-header"><img src="https://flagcdn.com/w40/${country.code}.png" style="margin-right:10px;"> ${country.name}</div>`;
                countryAthletes.forEach(ath => {
                    countryHtml += `<div style="padding:15px; border-bottom:1px solid var(--glass-border); background: rgba(0,0,0,0.1);"><strong>${ath.name}</strong>`;
                    for(let s=1; s<=cat.series; s++) {
                        countryHtml += `<div style="margin-top:10px; font-size:0.8rem;">Serija ${s}: `;
                        for(let a=1; a<=cat.attempts; a++) {
                            const existing = db.results.find(r => r.catId === catId && r.athId === ath.id && r.countryId === country.id && r.s == s && r.a == a);
                            countryHtml += `<input type="text" placeholder="Rez/DNF" class="r-val" data-ath="${ath.id}" data-country="${country.id}" data-s="${s}" data-a="${a}" value="${existing ? existing.val : ""}" style="width:75px; display:inline-block; margin-right:5px; margin-bottom:0;">`;
                        }
                        countryHtml += `</div>`;
                    }
                    countryHtml += `</div>`;
                });
                area.innerHTML += countryHtml;
            }
        });
        document.getElementById('btn-save-res').style.display = foundAny ? 'block' : 'none';
        if(!foundAny) area.innerHTML = `<div class="no-data-msg">Ni najdenih tekmovalcev. Dodaj jih v zavihku Države & Tekmovalci!</div>`;
    }

    function db_saveResults() {
        const catId = document.getElementById('res-cat-sel').value;
        const date = document.getElementById('res-date').value;
        const inputs = document.querySelectorAll('.r-val');
        inputs.forEach(i => {
            const val = i.value.trim().toUpperCase();
            db.results = db.results.filter(r => !(r.catId === catId && r.athId === i.dataset.ath && r.countryId === i.dataset.country && r.s == i.dataset.s && r.a == i.dataset.a));
            if(val !== "") {
                db.results.push({ catId, date, athId: i.dataset.ath, countryId: i.dataset.country, s: i.dataset.s, a: i.dataset.a, val: val === 'DNF' ? 'DNF' : parseFloat(val.replace(',', '.')) });
            }
        });
        sync();
        alert("Rezultati shranjeni!");
    }

    // --- NOVA LOGIKA SEŠTEVANJA IN DNF (3x DNF = OUT) ---
    function getRankings(catId) {
        const cat = db.categories.find(c => c.id === catId);
        if(!cat) return [];
        const catResults = db.results.filter(r => r.catId === catId);
        const keys = [...new Set(catResults.map(r => `${r.athId}-${r.countryId}`))];
        
        let performances = [];
        keys.forEach(key => {
            const [athId, countryId] = key.split('-');
            const results = catResults.filter(r => r.athId === athId && r.countryId === countryId);
            
            let dnfCount = 0;
            let sum = 0;
            
            results.forEach(r => {
                if(r.val === 'DNF') dnfCount++;
                else sum += r.val;
            });

            let finalVal = (dnfCount >= 3) ? "DNF" : sum;
            const ath = db.athletes.find(a => a.id === athId);
            const country = db.countries.find(c => c.id === countryId);

            performances.push({
                athId, countryId, val: finalVal,
                name: ath ? ath.name : '?', countryName: country ? country.name : '?', countryCode: country ? country.code : 'un'
            });
        });

        return performances.sort((a, b) => {
            if (a.val === "DNF" && b.val === "DNF") return 0;
            if (a.val === "DNF") return 1;
            if (b.val === "DNF") return -1;
            return cat.dir === 'asc' ? a.val - b.val : b.val - a.val;
        });
    }

    // --- UI RENDERING ---
    function refreshUI() {
        renderMedals();
        renderTotalScores();
        updateAdminDropdowns();
        renderPublicCatTabs();
    }

    function renderMedals() {
        let stats = {};
        db.countries.forEach(c => stats[c.id] = { gold:0, silver:0, bronze:0, total:0, name: c.name, code: c.code });
        db.categories.forEach(cat => {
            const rank = getRankings(cat.id);
            if(rank[0] && rank[0].val !== "DNF") { stats[rank[0].countryId].gold++; stats[rank[0].countryId].total++; }
            if(rank[1] && rank[1].val !== "DNF") { stats[rank[1].countryId].silver++; stats[rank[1].countryId].total++; }
            if(rank[2] && rank[2].val !== "DNF") { stats[rank[2].countryId].bronze++; stats[rank[2].countryId].total++; }
        });
        const sorted = Object.values(stats).sort((a,b) => b.gold - a.gold || b.silver - a.silver);
        document.getElementById('medal-table-body').innerHTML = sorted.map(c => `
            <tr>
                <td><img src="https://flagcdn.com/w80/${c.code}.png" class="flag-box"> ${c.name}</td>
                <td><strong>${c.total}</strong></td>
                <td><span class="medal-dot" style="background:var(--gold)"></span> ${c.gold}</td>
                <td><span class="medal-dot" style="background:var(--silver)"></span> ${c.silver}</td>
                <td><span class="medal-dot" style="background:var(--bronze)"></span> ${c.bronze}</td>
            </tr>
        `).join('');
    }

    function renderTotalScores() {
        let points = {};
        db.countries.forEach(c => points[c.id] = 0);
        db.categories.forEach(cat => {
            const rank = getRankings(cat.id);
            rank.forEach((r, i) => {
                if(r.val === "DNF") return;
                const pos = i + 1;
                let p = (pos === 1) ? 100 : (pos === 2) ? 80 : (pos === 3) ? 60 : Math.max(0, 50 - pos * 5);
                if(points[r.countryId] !== undefined) points[r.countryId] += p;
            });
        });
        const sorted = Object.entries(points).map(([id, p]) => ({ ...db.countries.find(c => c.id === id), p })).sort((a,b) => b.p - a.p);
        document.getElementById('total-points-body').innerHTML = sorted.filter(c => c.name).map((c, i) => `
            <tr><td>#${i+1}</td><td>${c.name}</td><td><img src="https://flagcdn.com/w80/${c.code}.png" class="flag-box"></td><td><strong>${c.p}</strong></td></tr>
        `).join('');
    }

    function renderPublicCatTabs() {
        document.getElementById('public-cat-tabs').innerHTML = db.categories.map(c => `<button class="tab-btn" onclick="showPublicCatResults('${c.id}', this)">${c.name}</button>`).join('');
    }

    function showPublicCatResults(catId, btn) {
        document.querySelectorAll('#public-cat-tabs .tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const rank = getRankings(catId);
        const cat = db.categories.find(c => c.id === catId);
        document.getElementById('cat-results-body').innerHTML = rank.map((r, i) => `
            <tr><td>${i+1}.</td><td>${r.name}</td><td>${r.countryName}</td><td><strong>${r.val === "DNF" ? "DNF" : r.val + " " + cat.unit}</strong></td></tr>
        `).join('');
    }

    function updateAdminDropdowns() {
        const cSel = document.getElementById('ath-c-sel');
        if(cSel) cSel.innerHTML = db.countries.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        const rSel = document.getElementById('res-cat-sel');
        if(rSel) {
            const current = rSel.value;
            rSel.innerHTML = '<option value="">Izberi kategorijo...</option>' + db.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            rSel.value = current;
        }
    }

    function handleLogin() {
        if(document.getElementById('user').value === 'ADMIN' && document.getElementById('pass').value === '1234') changeSection('admin-panel');
        else alert("Napačni podatki!");
    }

    function logout() { location.reload(); }
    refreshUI();
</script>
</body>
</html>
