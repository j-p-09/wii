<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doma캜e Olimpijske Igre 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root {
            --primary: #0081C8;
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            --bg-gradient: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- ANIMACIJE --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.6s ease forwards; }

        /* --- NAVIGACIJA --- */
        nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 10px 30px;
            display: flex;
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        nav button {
            background: transparent;
            border: none;
            color: white;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            border-radius: 20px;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        nav button:hover, nav button.active {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        /* --- VSEBINA --- */
        .container {
            padding-top: 120px;
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        section { display: none; }
        section.active { display: block; }

        .card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
        }

        h1, h2 { text-align: center; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 3px; }

        /* --- TABELE --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid var(--glass-border);
            color: rgba(255,255,255,0.7);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .flag-icon { width: 30px; height: 20px; object-fit: cover; border-radius: 3px; margin-right: 10px; vertical-align: middle; }

        .medal-icon { font-size: 1.2rem; }
        .gold { color: var(--gold); }
        .silver { color: var(--silver); }
        .bronze { color: var(--bronze); }

        /* --- FORME --- */
        input, select {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border);
            padding: 12px;
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
            width: 100%;
        }

        button.btn-action {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button.btn-action:hover { opacity: 0.8; }

        /* --- ADMIN DASHBOARD --- */
        .admin-grid {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
        }

        .admin-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* --- POSEBNOSTI --- */
        .score-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .pill {
            padding: 5px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            cursor: pointer;
        }

        .pill.active { background: white; color: black; }

        .dnf-tag { color: #ff4d4d; font-weight: bold; font-size: 0.7rem; }
    </style>
</head>
<body>

<nav>
    <button onclick="showSection('medals')" id="btn-medals" class="active">Medalje</button>
    <button onclick="showSection('categories')" id="btn-categories">Kategorije</button>
    <button onclick="showSection('total')" id="btn-total">Skupno</button>
    <button onclick="showSection('login')" id="btn-login">Prijava</button>
</nav>

<div class="container">
    
    <section id="medals" class="active fade-in">
        <h1>游끤 Medalje po dr쬬vah</h1>
        <div class="card">
            <table id="medal-table">
                <thead>
                    <tr>
                        <th>Dr쬬va</th>
                        <th><span class="medal-icon">游볞游볟游볠</span> Skupno</th>
                        <th>游볞</th>
                        <th>游볟</th>
                        <th>游볠</th>
                    </tr>
                </thead>
                <tbody id="medal-body">
                    </tbody>
            </table>
        </div>
    </section>

    <section id="categories" class="fade-in">
        <h1>游늵 Rezultati po kategorijah</h1>
        <div class="card">
            <select id="public-category-select" onchange="renderCategoryResults()">
                <option value="">Izberi kategorijo...</option>
            </select>
            <table id="category-results-table">
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Tekmovalec (Dr쬬va)</th>
                        <th>Rezultat</th>
                    </tr>
                </thead>
                <tbody id="category-results-body"></tbody>
            </table>
        </div>
    </section>

    <section id="total" class="fade-in">
        <h1>游끥 Skupni Se코tevek To캜k</h1>
        <div class="score-tabs">
            <div class="pill active" onclick="setScoreView('all', this)">Skupno</div>
            <div class="pill" onclick="setScoreView('indoor', this)">Notranje</div>
            <div class="pill" onclick="setScoreView('outdoor', this)">Zunanje</div>
        </div>
        <div class="card">
            <table id="total-score-table">
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Dr쬬va</th>
                        <th>To캜ke</th>
                    </tr>
                </thead>
                <tbody id="total-score-body"></tbody>
            </table>
        </div>
    </section>

    <section id="login" class="fade-in">
        <div class="card" style="max-width: 400px; margin: 0 auto;">
            <h2>Admin Prijava</h2>
            <input type="text" id="admin-user" placeholder="Uporabni코ko ime">
            <input type="password" id="admin-pass" placeholder="Geslo">
            <button class="btn-action" style="width: 100%;" onclick="checkLogin()">PRIJAVA</button>
        </div>
    </section>

    <section id="admin-panel" class="fade-in">
        <h1>丘뙖잺 Admin Nadzorna Plo코캜a</h1>
        <div class="admin-grid">
            <div class="admin-menu">
                <button class="pill" onclick="showAdminSub('admin-cats')">Kategorije</button>
                <button class="pill" onclick="showAdminSub('admin-results')">Vpis Rezultatov</button>
                <button class="pill" onclick="showAdminSub('admin-schedule')">Na캜rtovanje</button>
                <button class="pill" onclick="showAdminSub('admin-athletes')">Tekmovalci</button>
                <button class="pill" style="background: #ff4d4d; margin-top: 20px;" onclick="logout()">Odjava</button>
            </div>
            
            <div class="admin-content">
                <div id="admin-cats" class="admin-sub active">
                    <div class="card">
                        <h3>Nova Kategorija</h3>
                        <input type="text" id="cat-name" placeholder="Ime (npr. Met sekire)">
                        <select id="cat-type">
                            <option value="indoor">Notranje</option>
                            <option value="outdoor">Zunanje</option>
                        </select>
                        <input type="text" id="cat-unit" placeholder="Enota (s, m, to캜ke)">
                        <select id="cat-sort">
                            <option value="desc">Ve캜 je bolj코e (Daljava)</option>
                            <option value="asc">Manj je bolj코e (캛as)</option>
                        </select>
                        <input type="number" id="cat-series" placeholder="맚evilo serij">
                        <input type="number" id="cat-attempts" placeholder="Poskusov v seriji">
                        <button class="btn-action" onclick="saveCategory()">Shrani</button>
                    </div>
                </div>

                <div id="admin-results" class="admin-sub" style="display:none;">
                    <div class="card">
                        <h3>Vnos Rezultatov</h3>
                        <select id="res-cat-select" onchange="prepResultEntry()"></select>
                        <div id="result-inputs"></div>
                        <button class="btn-action" id="btn-save-res" style="display:none;" onclick="saveResults()">Shrani Rezultate</button>
                    </div>
                </div>

                <div id="admin-athletes" class="admin-sub" style="display:none;">
                    <div class="card">
                        <h3>Dodaj Dr쬬vo / Tekmovalca</h3>
                        <input type="text" id="country-name" placeholder="Ime dr쬬ve">
                        <input type="text" id="country-flag" placeholder="Emoji zastave (npr. 游젏릖)">
                        <button class="btn-action" onclick="saveCountry()">Dodaj Dr쬬vo</button>
                        <hr style="margin: 20px 0; opacity: 0.2;">
                        <input type="text" id="ath-name" placeholder="Ime tekmovalca">
                        <select id="ath-countries" multiple title="Dr쬴 CTRL za ve캜 dr쬬v"></select>
                        <button class="btn-action" onclick="saveAthlete()">Dodaj Tekmovalca</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

</div>

<script>
    // --- PODATKOVNA STRUKTURA ---
    let db = JSON.parse(localStorage.getItem('olympicsDB')) || {
        countries: [],
        athletes: [],
        categories: [],
        results: [],
        schedule: []
    };

    function saveDB() {
        localStorage.setItem('olympicsDB', JSON.stringify(db));
        renderAll();
    }

    // --- NAVIGACIJA ---
    function showSection(id) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('btn-' + id)?.classList.add('active');
        renderAll();
    }

    function showAdminSub(id) {
        document.querySelectorAll('.admin-sub').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    // --- LOGIKA: DR콯AVE & TEKMOVALCI ---
    function saveCountry() {
        const name = document.getElementById('country-name').value;
        const flag = document.getElementById('country-flag').value;
        if(name) {
            db.countries.push({ id: Date.now(), name, flag });
            saveDB();
            document.getElementById('country-name').value = '';
        }
    }

    function saveAthlete() {
        const name = document.getElementById('ath-name').value;
        const selectedCountries = Array.from(document.getElementById('ath-countries').selectedOptions).map(o => o.value);
        if(name && selectedCountries.length > 0) {
            db.athletes.push({ id: Date.now(), name, countryIds: selectedCountries });
            saveDB();
            document.getElementById('ath-name').value = '';
        }
    }

    // --- LOGIKA: KATEGORIJE ---
    function saveCategory() {
        const cat = {
            id: Date.now(),
            name: document.getElementById('cat-name').value,
            type: document.getElementById('cat-type').value,
            unit: document.getElementById('cat-unit').value,
            sort: document.getElementById('cat-sort').value,
            series: parseInt(document.getElementById('cat-series').value),
            attempts: parseInt(document.getElementById('cat-attempts').value)
        };
        db.categories.push(cat);
        saveDB();
    }

    // --- LOGIKA: REZULTATI & TO캛KOVANJE ---
    function prepResultEntry() {
        const catId = document.getElementById('res-cat-select').value;
        const cat = db.categories.find(c => c.id == catId);
        const div = document.getElementById('result-inputs');
        div.innerHTML = '';
        if(!cat) return;

        db.athletes.forEach(ath => {
            let html = `<div style="margin-bottom:20px; border-bottom:1px solid var(--glass-border); padding-bottom:10px;">
                <strong>${ath.name}</strong><br>`;
            for(let s=1; s<=cat.series; s++) {
                html += `Serija ${s}: `;
                for(let a=1; a<=cat.attempts; a++) {
                    html += `<input type="text" style="width:60px; display:inline;" placeholder="Rez/DNF" class="res-input" data-ath="${ath.id}" data-series="${s}" data-attempt="${a}"> `;
                }
                html += `<br>`;
            }
            html += `</div>`;
            div.innerHTML += html;
        });
        document.getElementById('btn-save-res').style.display = 'block';
    }

    function saveResults() {
        const catId = document.getElementById('res-cat-select').value;
        const cat = db.categories.find(c => c.id == catId);
        const inputs = document.querySelectorAll('.res-input');
        
        inputs.forEach(input => {
            const val = input.value;
            if(val !== "") {
                db.results = db.results.filter(r => !(r.catId == catId && r.athId == input.dataset.ath && r.series == input.dataset.series && r.attempt == input.dataset.attempt));
                db.results.push({
                    catId: catId,
                    athId: input.dataset.ath,
                    series: input.dataset.series,
                    attempt: input.dataset.attempt,
                    value: val.toUpperCase() === 'DNF' ? 'DNF' : parseFloat(val)
                });
            }
        });
        saveDB();
        alert("Rezultati shranjeni!");
    }

    // --- IZRA캛UNI (SRCE SISTEMA) ---
    function calculateMedals() {
        let stats = {};
        db.countries.forEach(c => stats[c.id] = { gold:0, silver:0, bronze:0, total:0, name: c.name, flag: c.flag });

        db.categories.forEach(cat => {
            const rankings = getCategoryRankings(cat.id);
            if(rankings.length > 0) {
                // Podelimo medalje (upo코tevamo tekmoval캜evo dr쬬vo - 캜e jih ima ve캜, dobi medaljo vsaka!)
                rankings.slice(0, 3).forEach((r, idx) => {
                    const athlete = db.athletes.find(a => a.id == r.athId);
                    athlete.countryIds.forEach(cId => {
                        if(idx === 0) stats[cId].gold++;
                        if(idx === 1) stats[cId].silver++;
                        if(idx === 2) stats[cId].bronze++;
                        stats[cId].total++;
                    });
                });
            }
        });
        return Object.values(stats).sort((a,b) => b.gold - a.gold || b.silver - a.silver);
    }

    function getCategoryRankings(catId) {
        const cat = db.categories.find(c => c.id == catId);
        let athScores = [];

        db.athletes.forEach(ath => {
            const res = db.results.filter(r => r.catId == catId && r.athId == ath.id);
            if(res.length === 0) return;

            // Preveri DNF diskvalifikacijo (캜e je v kateri koli seriji ve캜 kot 2 DNF)
            let isDisqualified = false;
            for(let s=1; s<=cat.series; s++) {
                const seriesDNF = res.filter(r => r.series == s && r.value === 'DNF').length;
                if(seriesDNF > 2) isDisqualified = true;
            }

            if(!isDisqualified) {
                const numericRes = res.filter(r => r.value !== 'DNF').map(r => r.value);
                const best = cat.sort === 'desc' ? Math.max(...numericRes) : Math.min(...numericRes);
                athScores.push({ athId: ath.id, best: best, name: ath.name });
            }
        });

        return athScores.sort((a,b) => cat.sort === 'desc' ? b.best - a.best : a.best - b.best);
    }

    function calculateTotalScore(filterType = 'all') {
        let countryPoints = {};
        db.countries.forEach(c => countryPoints[c.id] = 0);

        db.categories.forEach(cat => {
            if(filterType !== 'all' && cat.type !== filterType) return;

            const rankings = getCategoryRankings(cat.id);
            rankings.forEach((rank, index) => {
                const place = index + 1;
                let pts = 0;
                if(place === 1) pts = 100;
                else if(place === 2) pts = 80;
                else if(place === 3) pts = 60;
                else if(place === 4) pts = 40;
                else if(place === 5) pts = 35;
                else pts = Math.max(0, 35 - (place - 5) * 0.02);

                const ath = db.athletes.find(a => a.id == rank.athId);
                ath.countryIds.forEach(cId => countryPoints[cId] += pts);
            });
        });
        return Object.entries(countryPoints)
            .map(([id, pts]) => ({ name: db.countries.find(c => c.id == id).name, pts }))
            .sort((a,b) => b.pts - a.pts);
    }

    // --- RENDERING ---
    function renderAll() {
        renderMedals();
        renderTotalScores();
        updateDropdowns();
    }

    function renderMedals() {
        const data = calculateMedals();
        const body = document.getElementById('medal-body');
        body.innerHTML = data.map(c => `
            <tr>
                <td>${c.flag} ${c.name}</td>
                <td><strong>${c.total}</strong></td>
                <td class="gold">${c.gold}</td>
                <td class="silver">${c.silver}</td>
                <td class="bronze">${c.bronze}</td>
            </tr>
        `).join('');
    }

    function renderTotalScores() {
        const data = calculateTotalScore(currentScoreView);
        document.getElementById('total-score-body').innerHTML = data.map((c, i) => `
            <tr>
                <td>${i+1}.</td>
                <td>${c.name}</td>
                <td>${c.pts.toFixed(2)}</td>
            </tr>
        `).join('');
    }

    function renderCategoryResults() {
        const catId = document.getElementById('public-category-select').value;
        const rankings = getCategoryRankings(catId);
        const body = document.getElementById('category-results-body');
        body.innerHTML = rankings.map((r, i) => `
            <tr>
                <td>${i+1}.</td>
                <td>${r.name}</td>
                <td>${r.best}</td>
            </tr>
        `).join('');
    }

    let currentScoreView = 'all';
    function setScoreView(view, el) {
        currentScoreView = view;
        document.querySelectorAll('.score-tabs .pill').forEach(p => p.classList.remove('active'));
        el.classList.add('active');
        renderTotalScores();
    }

    function updateDropdowns() {
        const catSelects = ['public-category-select', 'res-cat-select'];
        catSelects.forEach(id => {
            const el = document.getElementById(id);
            if(el) {
                const val = el.value;
                el.innerHTML = '<option value="">Izberi...</option>' + 
                    db.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                el.value = val;
            }
        });

        const athCountries = document.getElementById('ath-countries');
        if(athCountries) {
            athCountries.innerHTML = db.countries.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }
    }

    // --- AUTH ---
    function checkLogin() {
        const user = document.getElementById('admin-user').value;
        const pass = document.getElementById('admin-pass').value;
        if(user === 'ADMIN' && pass === '1234') { // Preprosto geslo za demo
            showSection('admin-panel');
        } else {
            alert('Napa캜ni podatki!');
        }
    }

    function logout() { showSection('login'); }

    // Init
    renderAll();
</script>

</body>
</html>
