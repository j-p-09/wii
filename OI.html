<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMAČE OLIMPIJSKE IGRE 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.08);
            --glass-heavy: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.18);
            --accent: #00d2ff;
            --gold: #FFD700;
            --silver: #E3E3E3;
            --bronze: #CD7F32;
            --danger: #ff4757;
            --success: #2ed573;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background: radial-gradient(circle at top right, #1e3c72, #2a5298, #000);
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- ANIMACIJE --- */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .animate { animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* --- GLAVNI MENI --- */
        .nav-wrapper {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: fit-content;
        }

        nav#main-nav {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            padding: 8px 15px;
            display: flex;
            gap: 5px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        nav#main-nav button {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            border-radius: 100px;
            transition: all 0.4s ease;
        }

        nav#main-nav button.active, nav#main-nav button:hover {
            background: var(--glass-heavy);
            color: #fff;
            text-shadow: 0 0 10px var(--accent);
        }

        /* --- KONTEJNERJI --- */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 140px 20px 60px;
        }

        section { display: none; }
        section.active { display: block; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        h1 { font-weight: 800; font-size: 2.5rem; text-align: center; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 5px; }

        /* --- TABELE --- */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { padding: 15px; text-align: left; color: rgba(255,255,255,0.5); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; }
        td { padding: 15px; background: rgba(255,255,255,0.03); vertical-align: middle; }
        tr td:first-child { border-radius: 15px 0 0 15px; }
        tr td:last-child { border-radius: 0 15px 15px 0; }

        .flag-box {
            width: 45px;
            height: 30px;
            border-radius: 6px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-right: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .medal-group { display: flex; align-items: center; gap: 5px; }
        .medal-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }

        /* --- FILTRI / POGLEDI --- */
        .view-tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .tab-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab-btn.active { background: var(--accent); border-color: var(--accent); font-weight: bold; }

        /* --- ADMIN PANEL --- */
        .admin-layout { display: grid; grid-template-columns: 240px 1fr; gap: 30px; }
        .admin-sidebar { display: flex; flex-direction: column; gap: 10px; }
        .admin-sidebar button {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 15px;
            text-align: left;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        .admin-sidebar button:hover, .admin-sidebar button.active { background: rgba(255,255,255,0.2); transform: translateX(5px); }

        /* --- INPUTI --- */
        input, select, textarea {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            padding: 12px 15px;
            color: #fff;
            border-radius: 12px;
            width: 100%;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        .btn-save { background: var(--accent); color: #000; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: 800; width: 100%; }

        .dnf-badge { background: var(--danger); font-size: 0.6rem; padding: 2px 5px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="nav-wrapper">
    <nav id="main-nav">
        <button onclick="changeSection('medals', this)" class="active">Medalije</button>
        <button onclick="changeSection('categories', this)">Kategorije</button>
        <button onclick="changeSection('total', this)">Skupni seštevek</button>
        <button onclick="changeSection('login', this)">Prijava</button>
    </nav>
</div>

<div class="container">
    
    <section id="medals" class="active animate">
        <h1>Olimpijske Medalje</h1>
        <div class="glass-card">
            <table>
                <thead>
                    <tr>
                        <th>Država</th>
                        <th><i class="fas fa-medal"></i> Skupno</th>
                        <th><i class="fas fa-circle" style="color:var(--gold)"></i> Zlato</th>
                        <th><i class="fas fa-circle" style="color:var(--silver)"></i> Srebro</th>
                        <th><i class="fas fa-circle" style="color:var(--bronze)"></i> Bron</th>
                    </tr>
                </thead>
                <tbody id="medal-table-body"></tbody>
            </table>
        </div>
    </section>

    <section id="categories" class="animate">
        <h1>Rezultati po Kategorijah</h1>
        <div class="view-tabs" id="public-cat-tabs"></div>
        <div class="glass-card">
            <table id="cat-results-table">
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Tekmovalec</th>
                        <th>Država</th>
                        <th>Rezultat</th>
                    </tr>
                </thead>
                <tbody id="cat-results-body"></tbody>
            </table>
        </div>
    </section>

    <section id="total" class="animate">
        <h1>Skupna Razvrstitev</h1>
        <div class="view-tabs">
            <button class="tab-btn active" onclick="updateTotalView('all', this)">Skupno</button>
            <button class="tab-btn" onclick="updateTotalView('indoor', this)">Notranje</button>
            <button class="tab-btn" onclick="updateTotalView('outdoor', this)">Zunanje</button>
        </div>
        <div class="glass-card">
            <table>
                <thead>
                    <tr>
                        <th>Mesto</th>
                        <th>Država</th>
                        <th>Zastava</th>
                        <th>Točke</th>
                    </tr>
                </thead>
                <tbody id="total-points-body"></tbody>
            </table>
        </div>
    </section>

    <section id="login" class="animate">
        <div class="glass-card" style="max-width: 450px; margin: 0 auto;">
            <h2 style="text-align: center; margin-bottom: 30px;">Admin Prijava</h2>
            <label>Uporabniško ime</label>
            <input type="text" id="user" placeholder="ADMIN">
            <label>Geslo</label>
            <input type="password" id="pass" placeholder="••••••••">
            <button class="btn-save" onclick="handleLogin()">VSTOPI</button>
        </div>
    </section>

    <section id="admin-panel" class="animate">
        <h1>Nadzorna Plošča (ADMIN)</h1>
        <div class="admin-layout">
            <div class="admin-sidebar">
                <button onclick="showAdminSub('a-cats', this)" class="active">Kategorije</button>
                <button onclick="showAdminSub('a-res', this)">Vpis Rezultatov</button>
                <button onclick="showAdminSub('a-plan', this)">Načrtovanje</button>
                <button onclick="showAdminSub('a-athletes', this)">Tekmovalci</button>
                <button onclick="logout()" style="color:var(--danger)">Odjava</button>
            </div>
            
            <div class="admin-main">
                <div id="a-cats" class="admin-sub animate">
                    <div class="glass-card">
                        <h3>Upravljanje Kategorij</h3>
                        <input type="text" id="cat-name" placeholder="Ime kategorije (npr. Tek na 100m)">
                        <select id="cat-env"><option value="outdoor">Zunanje</option><option value="indoor">Notranje</option></select>
                        <input type="text" id="cat-unit" placeholder="Enota (sek, m, kg)">
                        <select id="cat-dir"><option value="asc">Manj je bolje (Čas)</option><option value="desc">Več je bolje (Daljava)</option></select>
                        <input type="number" id="cat-series" placeholder="Število serij">
                        <input type="number" id="cat-attempts" placeholder="Poskusov v seriji">
                        <button class="btn-save" onclick="db_addCategory()">Dodaj Kategorijo</button>
                    </div>
                </div>

                <div id="a-res" class="admin-sub" style="display:none;">
                    <div class="glass-card">
                        <h3>Vpis Rezultatov</h3>
                        <select id="res-cat-sel" onchange="loadResultEntry()"></select>
                        <input type="date" id="res-date">
                        <div id="res-entry-area"></div>
                        <button class="btn-save" id="btn-save-res" style="display:none;" onclick="db_saveResults()">Shrani Rezultate</button>
                    </div>
                </div>

                <div id="a-plan" class="admin-sub" style="display:none;">
                    <div class="glass-card">
                        <h3>Načrtovanje Dogodkov</h3>
                        <p>Funkcija za razporejanje kategorij po datumih.</p>
                        </div>
                </div>

                <div id="a-athletes" class="admin-sub" style="display:none;">
                    <div class="glass-card">
                        <h3>Države & Tekmovalci</h3>
                        <input type="text" id="c-name" placeholder="Ime države">
                        <input type="text" id="c-code" placeholder="ISO Koda (npr: si, us, de, it)">
                        <button class="btn-save" style="background:#444; color:#fff; margin-bottom:20px;" onclick="db_addCountry()">Dodaj Državo</button>
                        
                        <input type="text" id="ath-name" placeholder="Ime tekmovalca">
                        <label>Izberi države (več hkrati z CTRL)</label>
                        <select id="ath-c-sel" multiple style="height:100px;"></select>
                        <button class="btn-save" onclick="db_addAthlete()">Dodaj Tekmovalca</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

</div>

<script>
    // --- DATABASE INITIALIZATION ---
    let db = JSON.parse(localStorage.getItem('olympics_pro_db')) || {
        countries: [],
        athletes: [],
        categories: [],
        results: [],
        schedule: []
    };

    function sync() {
        localStorage.setItem('olympics_pro_db', JSON.stringify(db));
        refreshUI();
    }

    // --- NAVIGATION ---
    function changeSection(id, btn) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('#main-nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        refreshUI();
    }

    function showAdminSub(id, btn) {
        document.querySelectorAll('.admin-sub').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.admin-sidebar button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).style.display = 'block';
        btn.classList.add('active');
    }

    // --- DATA HANDLING ---
    function db_addCountry() {
        const name = document.getElementById('c-name').value;
        const code = document.getElementById('c-code').value.toLowerCase();
        if(name && code) {
            db.countries.push({ id: Date.now(), name, code });
            sync();
            document.getElementById('c-name').value = '';
            document.getElementById('c-code').value = '';
        }
    }

    function db_addAthlete() {
        const name = document.getElementById('ath-name').value;
        const cIds = Array.from(document.getElementById('ath-c-sel').selectedOptions).map(o => o.value);
        if(name && cIds.length > 0) {
            db.athletes.push({ id: Date.now(), name, countries: cIds });
            sync();
            document.getElementById('ath-name').value = '';
        }
    }

    function db_addCategory() {
        const cat = {
            id: Date.now(),
            name: document.getElementById('cat-name').value,
            env: document.getElementById('cat-env').value,
            unit: document.getElementById('cat-unit').value,
            dir: document.getElementById('cat-dir').value,
            series: parseInt(document.getElementById('cat-series').value),
            attempts: parseInt(document.getElementById('cat-attempts').value)
        };
        db.categories.push(cat);
        sync();
    }

    // --- RESULT LOGIC ---
    function loadResultEntry() {
        const catId = document.getElementById('res-cat-sel').value;
        const cat = db.categories.find(c => c.id == catId);
        const area = document.getElementById('res-entry-area');
        area.innerHTML = '';
        if(!cat) return;

        db.athletes.forEach(ath => {
            let html = `<div style="padding:15px; border-bottom:1px solid var(--glass-border);">
                        <strong>${ath.name}</strong><br>`;
            for(let s=1; s<=cat.series; s++) {
                html += `<div style="margin:5px 0; font-size:0.8rem;">Serija ${s}: `;
                for(let a=1; a<=cat.attempts; a++) {
                    html += `<input type="text" placeholder="Rez/DNF" class="r-val" data-ath="${ath.id}" data-s="${s}" data-a="${a}" style="width:70px; display:inline-block; margin-right:5px;">`;
                }
                html += `</div>`;
            }
            html += `</div>`;
            area.innerHTML += html;
        });
        document.getElementById('btn-save-res').style.display = 'block';
    }

    function db_saveResults() {
        const catId = document.getElementById('res-cat-sel').value;
        const date = document.getElementById('res-date').value;
        const inputs = document.querySelectorAll('.r-val');
        
        inputs.forEach(i => {
            if(i.value !== "") {
                db.results = db.results.filter(r => !(r.catId == catId && r.athId == i.dataset.ath && r.s == i.dataset.s && r.a == i.dataset.a));
                db.results.push({
                    catId, date, athId: i.dataset.ath, s: i.dataset.s, a: i.dataset.a, 
                    val: i.value.toUpperCase() === 'DNF' ? 'DNF' : parseFloat(i.value)
                });
            }
        });
        sync();
        alert("Rezultati shranjeni!");
    }

    // --- CALCULATIONS ---
    function getRankings(catId) {
        const cat = db.categories.find(c => c.id == catId);
        if(!cat) return [];
        let athRankings = [];

        db.athletes.forEach(ath => {
            const results = db.results.filter(r => r.catId == catId && r.athId == ath.id);
            if(results.length === 0) return;

            let isDQ = false;
            let bestVal = cat.dir === 'asc' ? Infinity : -Infinity;

            for(let s=1; s<=cat.series; s++) {
                const sRes = results.filter(r => r.s == s);
                const dnfCount = sRes.filter(r => r.val === 'DNF').length;
                if(dnfCount > 2) isDQ = true;
                
                sRes.forEach(r => {
                    if(r.val !== 'DNF') {
                        if(cat.dir === 'asc') { if(r.val < bestVal) bestVal = r.val; }
                        else { if(r.val > bestVal) bestVal = r.val; }
                    }
                });
            }

            if(!isDQ && bestVal !== Infinity && bestVal !== -Infinity) {
                athRankings.push({ athId: ath.id, val: bestVal, name: ath.name, countries: ath.countries });
            }
        });

        return athRankings.sort((a,b) => cat.dir === 'asc' ? a.val - b.val : b.val - a.val);
    }

    // --- REFRESH UI ---
    function refreshUI() {
        renderMedals();
        renderTotalScores();
        updateAdminDropdowns();
        renderPublicCatTabs();
    }

    function renderMedals() {
        let stats = {};
        db.countries.forEach(c => stats[c.id] = { gold:0, silver:0, bronze:0, total:0, name: c.name, code: c.code });

        db.categories.forEach(cat => {
            const rank = getRankings(cat.id);
            rank.slice(0, 3).forEach((r, i) => {
                r.countries.forEach(cId => {
                    if(stats[cId]) {
                        if(i === 0) stats[cId].gold++;
                        else if(i === 1) stats[cId].silver++;
                        else if(i === 2) stats[cId].bronze++;
                        stats[cId].total++;
                    }
                });
            });
        });

        const sorted = Object.values(stats).sort((a,b) => b.gold - a.gold || b.silver - a.silver);
        document.getElementById('medal-table-body').innerHTML = sorted.map(c => `
            <tr>
                <td><img src="https://flagcdn.com/w80/${c.code}.png" class="flag-box"> ${c.name}</td>
                <td><strong>${c.total}</strong></td>
                <td><span class="medal-dot" style="background:var(--gold)"></span> ${c.gold}</td>
                <td><span class="medal-dot" style="background:var(--silver)"></span> ${c.silver}</td>
                <td><span class="medal-dot" style="background:var(--bronze)"></span> ${c.bronze}</td>
            </tr>
        `).join('');
    }

    let currentTotalView = 'all';
    function updateTotalView(view, btn) {
        currentTotalView = view;
        document.querySelectorAll('#total .tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderTotalScores();
    }

    function renderTotalScores() {
        let points = {};
        db.countries.forEach(c => points[c.id] = 0);

        db.categories.forEach(cat => {
            if(currentTotalView !== 'all' && cat.env !== currentTotalView) return;
            const rank = getRankings(cat.id);
            rank.forEach((r, i) => {
                const pos = i + 1;
                let p = 0;
                if(pos === 1) p = 100;
                else if(pos === 2) p = 80;
                else if(pos === 3) p = 60;
                else if(pos === 4) p = 40;
                else if(pos === 5) p = 35;
                else p = Math.max(0, 35 - (pos - 5) * 0.02);
                
                r.countries.forEach(cId => { if(points[cId] !== undefined) points[cId] += p; });
            });
        });

        const sorted = Object.entries(points)
            .map(([id, p]) => ({ ...db.countries.find(c => c.id == id), p }))
            .sort((a,b) => b.p - a.p);

        document.getElementById('total-points-body').innerHTML = sorted.map((c, i) => `
            <tr>
                <td>#${i+1}</td>
                <td>${c.name}</td>
                <td><img src="https://flagcdn.com/w80/${c.code}.png" class="flag-box"></td>
                <td><strong>${c.p.toFixed(2)}</strong></td>
            </tr>
        `).join('');
    }

    function renderPublicCatTabs() {
        const container = document.getElementById('public-cat-tabs');
        container.innerHTML = db.categories.map(c => `
            <button class="tab-btn" onclick="showPublicCatResults('${c.id}', this)">${c.name}</button>
        `).join('');
    }

    function showPublicCatResults(catId, btn) {
        document.querySelectorAll('#public-cat-tabs .tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const rank = getRankings(catId);
        const cat = db.categories.find(c => c.id == catId);
        document.getElementById('cat-results-body').innerHTML = rank.map((r, i) => `
            <tr>
                <td>${i+1}.</td>
                <td>${r.name}</td>
                <td>${r.countries.map(cId => db.countries.find(cx => cx.id == cId)?.name).join(', ')}</td>
                <td>${r.val} ${cat.unit}</td>
            </tr>
        `).join('');
    }

    function updateAdminDropdowns() {
        const cSel = document.getElementById('ath-c-sel');
        if(cSel) cSel.innerHTML = db.countries.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        
        const rSel = document.getElementById('res-cat-sel');
        if(rSel) rSel.innerHTML = '<option value="">Izberi kategorijo...</option>' + db.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    }

    function handleLogin() {
        if(document.getElementById('user').value === 'ADMIN' && document.getElementById('pass').value === '1234') {
            changeSection('admin-panel', document.createElement('button'));
        } else alert("Napačni podatki!");
    }

    function logout() { location.reload(); }

    // Start
    refreshUI();
</script>

</body>
</html>
